# 预测市场交互式Demo使用说明

## 🚀 快速开始

### 1. 启动完整Demo
```bash
./start_full_demo.sh
```

### 2. 选择演示模式
- **交互式演示 (推荐)**: 可以一步步点击操作，支持真实USDC领取
- **静态展示**: 查看完整流程和交易记录

### 3. 访问网页
- 交互式演示: http://localhost:8000/interactive_demo.html
- 静态展示: http://localhost:8000/index.html

## 💰 USDC领取功能

### 功能说明
- 用户可以输入自己的钱包地址领取1000个测试USDC
- 使用真实的智能合约交互 (USDC地址: 0xC1C68E532E3F2e1F40e6b5EBC9D6c5f8c5e803D6)
- 支持地址验证和余额检查
- USDC使用6位小数，1000 USDC = 1000 * 10^6

### 使用方法
1. 在网页中输入您的钱包地址 (0x...)
2. 点击"领取1000 USDC"按钮
3. 等待交易确认
4. 查看交易记录和余额更新

### 命令行使用
```bash
# 领取USDC到指定地址
node claim_usdc.js 0x319749f49C884a2F0141e53187dd1454E217786f

# 检查地址余额
node -e "
const USDCClaimer = require('./claim_usdc.js');
const claimer = new USDCClaimer();
claimer.checkBalance('0x319749f49C884a2F0141e53187dd1454E217786f').then(console.log);
"
```

## 🎯 真实链上合约交互式演示流程

> **重要说明**: 本演示使用真实的HashKey测试网智能合约，所有操作都会产生真实的交易哈希和链上记录！

### 第一步：发市场 - 创建预测市场
1. **领取USDC**: 输入钱包地址，点击领取1000 USDC
   - 🔍 可以点击"查看余额"按钮查询地址的USDC余额
2. **输入市场问题**: 输入预测市场问题 (如：明天会下雨吗？)
3. **创建市场**: 点击"创建预测市场"按钮
4. **自动处理**: 管理员自动创建YES/NO代币各1000个，存入2000 USDC抵押品
   - ✅ 真实的USDC转账到CTF合约
   - ✅ 真实的代币铸造交易
   - ✅ 真实的代币注册到Exchange
   - ✅ 合约中抵押USDC余额: 2000 USDC
5. **授权合约**: 点击"授权合约管理代币"按钮

### 第二步：买入YES - 创建买入订单
1. **创建订单**: 点击"创建买入订单"按钮
2. **签名订单**: 点击"签名订单"按钮
3. **执行订单**: 点击"执行订单"按钮

### 第三步：事件结算 - 设置市场结果
1. **选择结果**: 点击"设置YES获胜"或"设置NO获胜"

### 第四步：清算拿回资产 - 兑换获胜代币
1. **存入抵押品**: 点击"存入抵押品"按钮
2. **兑换代币**: 点击"兑换获胜代币"按钮
3. **检查余额**: 点击"检查最终余额"按钮

## 🔧 技术架构

### 前端
- **HTML/CSS/JavaScript**: 交互式界面
- **响应式设计**: 支持移动端
- **实时更新**: 余额和状态实时显示

### 后端
- **Express.js**: API服务器
- **ethers.js**: 区块链交互
- **CORS**: 跨域支持

### 智能合约
- **CTF Exchange**: 0x666DDb461FDb5E10BF6329513D609615C069E489
- **OpenZeppelin ERC1155 CTF**: 0x3338E58FAFfE71F89b2Bcb48384C9424c36060c6
- **USDC (抵押品)**: 0xC1C68E532E3F2e1F40e6b5EBC9D6c5f8c5e803D6
- **清算合约**: 0x38c7b0471D2b06991F94901ad7cf57B3D28b97BA

### 网络配置
- **网络**: HashKey测试网
- **RPC**: https://testnet.hsk.xyz
- **Chain ID**: 133
- **Gas代币**: HSK

## 📱 API接口

### 查看USDC余额
```bash
GET http://localhost:3001/api/balance/0x319749f49C884a2F0141e53187dd1454E217786f

# 响应
{
  "success": true,
  "address": "0x319749f49C884a2F0141e53187dd1454E217786f",
  "balance": "990900.0"
}
```

### 获取所有市场
```bash
GET http://localhost:3001/api/markets

# 响应
{
  "success": true,
  "markets": [
    {
      "id": "0x62092ce50d4ed31ec4bd3e455ff5f937f47b01d2428f2e1c4e2dd57e65006e97",
      "question": "测试市场保存功能",
      "conditionId": "0x62092ce50d4ed31ec4bd3e455ff5f937f47b01d2428f2e1c4e2dd57e65006e97",
      "yesTokenId": "0x62092ce50d4ed31ec4bd3e455ff5f937f47b01d2428f2e1c4e2dd57e65006e97",
      "noTokenId": "0xea88d183b733a24ae2f260d013203621373ef64bd413e9cb3b971b90cf237299",
      "transactions": {
        "usdcTransfer": "0x4c99eee46465e974c8288ee2a9da124dcbfceba50324433574a9f9cbba2db38b",
        "mintYes": "0x7a716394ede4653b396a9e1158ea2bf6b118ba6ed280bc8a79944bcf48c53f74",
        "mintNo": "0x179740fdf5413245bfa9a9f807764555fcc4703ad495ba4016b6f61e3b575d53",
        "register": "0xfc6ffd31cff3fe4f5ddbd92fda688153bf6ba5b127dbd70c305d3de6691ab14f"
      },
      "balances": {
        "yes": "1000.0",
        "no": "1000.0"
      },
      "createdAt": "2025-09-24T08:14:48.797Z",
      "status": "active"
    }
  ],
  "total": 1
}
```

### 获取特定市场
```bash
GET http://localhost:3001/api/markets/0x62092ce50d4ed31ec4bd3e455ff5f937f47b01d2428f2e1c4e2dd57e65006e97

# 响应
{
  "success": true,
  "market": {
    "id": "0x62092ce50d4ed31ec4bd3e455ff5f937f47b01d2428f2e1c4e2dd57e65006e97",
    "question": "测试市场保存功能",
    "conditionId": "0x62092ce50d4ed31ec4bd3e455ff5f937f47b01d2428f2e1c4e2dd57e65006e97",
    "yesTokenId": "0x62092ce50d4ed31ec4bd3e455ff5f937f47b01d2428f2e1c4e2dd57e65006e97",
    "noTokenId": "0xea88d183b733a24ae2f260d013203621373ef64bd413e9cb3b971b90cf237299",
    "transactions": {
      "usdcTransfer": "0x4c99eee46465e974c8288ee2a9da124dcbfceba50324433574a9f9cbba2db38b",
      "mintYes": "0x7a716394ede4653b396a9e1158ea2bf6b118ba6ed280bc8a79944bcf48c53f74",
      "mintNo": "0x179740fdf5413245bfa9a9f807764555fcc4703ad495ba4016b6f61e3b575d53",
      "register": "0xfc6ffd31cff3fe4f5ddbd92fda688153bf6ba5b127dbd70c305d3de6691ab14f"
    },
    "balances": {
      "yes": "1000.0",
      "no": "1000.0"
    },
    "createdAt": "2025-09-24T08:14:48.797Z",
    "status": "active"
  }
}
```

### 领取USDC
```bash
POST http://localhost:3001/api/claim-usdc
Content-Type: application/json

{
  "address": "0x319749f49C884a2F0141e53187dd1454E217786f"
}
```

### 检查余额
```bash
GET http://localhost:3001/api/balance/0x319749f49C884a2F0141e53187dd1454E217786f
```

### 健康检查
```bash
GET http://localhost:3001/api/health
```

## 🎉 演示效果

### 向领导展示的优势
1. **真实交互**: 一步步点击操作，就像真实使用一样
2. **实时反馈**: 余额变化、进度条、动画效果
3. **完整流程**: 从发市场到清算的完整演示
4. **技术展示**: 真实的智能合约交互和交易记录
5. **专业界面**: 现代化的UI设计

### 演示要点
- 展示完整的预测市场业务流程
- 演示真实的USDC领取功能
- 展示市场创建和代币自动铸造
- 展示智能合约的交互能力
- 展示用户友好的界面设计

## 🔍 故障排除

### 常见问题
1. **USDC领取失败**: 检查网络连接和地址格式
2. **API连接失败**: 确保API服务器正在运行
3. **交易失败**: 检查Gas费用和网络状态

### 日志查看
```bash
# 查看API服务器日志
tail -f usdc_api.log

# 查看交易记录
cat transaction_log.json
```

## 📞 技术支持

如有问题，请检查：
1. 网络连接是否正常
2. 依赖包是否安装完整
3. 智能合约地址是否正确
4. 钱包地址格式是否正确

---

**注意**: 这是测试网环境，所有代币都是测试代币，仅用于演示目的。
